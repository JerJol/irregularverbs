<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Révision Verbes Irréguliers</title>
    <style>
        :root {
  /* Primitive Color Tokens */
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-teal-800: rgba(41, 150, 161, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);

  /* RGB versions for opacity control */
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;
  --color-red-500-rgb: 192, 21, 47;
  --color-red-400-rgb: 255, 84, 89;
  --color-orange-500-rgb: 168, 75, 47;
  --color-orange-400-rgb: 230, 129, 97;

  /* Background color tokens (Dark Mode) */
  --color-bg-1: rgba(59, 130, 246, 0.15);
  --color-bg-2: rgba(245, 158, 11, 0.15);
  --color-bg-3: rgba(34, 197, 94, 0.15);
  --color-bg-4: rgba(239, 68, 68, 0.15);
  --color-bg-5: rgba(147, 51, 234, 0.15);
  --color-bg-6: rgba(249, 115, 22, 0.15);
  --color-bg-7: rgba(236, 72, 153, 0.15);
  --color-bg-8: rgba(6, 182, 212, 0.15);

  /* FORCED DARK THEME */
  --color-background: #1a1a1a;
  --color-surface: #242424;
  --color-text: #e0e0e0;
  --color-text-secondary: rgba(224, 224, 224, 0.7);
  --color-primary: #32B8C6;
  --color-primary-hover: #2DA6B2;
  --color-primary-active: #2996A1;
  --color-secondary: rgba(255, 255, 255, 0.08);
  --color-secondary-hover: rgba(255, 255, 255, 0.12);
  --color-secondary-active: rgba(255, 255, 255, 0.15);
  --color-border: rgba(255, 255, 255, 0.1);
  --color-btn-primary-text: #1a1a1a;
  --color-card-border: rgba(255, 255, 255, 0.1);
  --color-card-border-inner: rgba(255, 255, 255, 0.08);
  --color-error: #FF5459;
  --color-success: #32B8C6;
  --color-warning: #E68161;
  --color-info: #A7A9A9;
  --color-focus-ring: rgba(50, 184, 198, 0.4);
  --color-select-caret: rgba(224, 224, 224, 0.8);

  /* Common style patterns */
  --focus-ring: 0 0 0 3px var(--color-focus-ring);
  --focus-outline: 2px solid var(--color-primary);
  --status-bg-opacity: 0.15;
  --status-border-opacity: 0.25;
  --select-caret-light: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23e0e0e0' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  --select-caret-dark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23f5f5f5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");

  /* RGB versions for opacity control */
  --color-success-rgb: 50, 184, 198;
  --color-error-rgb: 255, 84, 89;
  --color-warning-rgb: 230, 129, 97;
  --color-info-rgb: 167, 169, 169;

  /* Typography */
  --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system,
    BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo,
    Monaco, Consolas, monospace;
  --font-size-xs: 11px;
  --font-size-sm: 12px;
  --font-size-base: 14px;
  --font-size-md: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-2xl: 20px;
  --font-size-3xl: 24px;
  --font-size-4xl: 30px;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 550;
  --font-weight-bold: 600;
  --line-height-tight: 1.2;
  --line-height-normal: 1.5;
  --letter-spacing-tight: -0.01em;

  /* Spacing */
  --space-0: 0;
  --space-1: 1px;
  --space-2: 2px;
  --space-4: 4px;
  --space-6: 6px;
  --space-8: 8px;
  --space-10: 10px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;
  --space-32: 32px;

  /* Border Radius */
  --radius-sm: 6px;
  --radius-base: 8px;
  --radius-md: 10px;
  --radius-lg: 12px;
  --radius-full: 9999px;

  /* Shadows */
  --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04),
    0 2px 4px -1px rgba(0, 0, 0, 0.02);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04),
    0 4px 6px -2px rgba(0, 0, 0, 0.02);
  --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15),
    inset 0 -1px 0 rgba(0, 0, 0, 0.03);

  /* Animation */
  --duration-fast: 150ms;
  --duration-normal: 250ms;
  --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);

  /* Layout */
  --container-sm: 640px;
  --container-md: 768px;
  --container-lg: 1024px;
  --container-xl: 1280px;
}

/* Dark theme forced - no media query needed */

@font-face {
  font-family: 'FKGroteskNeue';
  src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2')
    format('woff2');
}

html {
  font-size: var(--font-size-base);
  font-family: var(--font-family-base);
  line-height: var(--line-height-normal);
  color: var(--color-text);
  background-color: var(--color-background);
  -webkit-font-smoothing: antialiased;
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 0;
}

*,
*::before,
*::after {
  box-sizing: inherit;
}

h1,
h2,
h3,
h4,
h5,
h6 {
  margin: 0;
  font-weight: var(--font-weight-semibold);
  line-height: var(--line-height-tight);
  color: var(--color-text);
  letter-spacing: var(--letter-spacing-tight);
}

h1 {
  font-size: var(--font-size-4xl);
}
h2 {
  font-size: var(--font-size-3xl);
}
h3 {
  font-size: var(--font-size-2xl);
}

.container {
  max-width: 800px;
  margin: 0 auto;
  padding: var(--space-32);
}

.header {
  text-align: center;
  margin-bottom: var(--space-32);
}

.header h1 {
  margin-bottom: var(--space-8);
}

.header p {
  color: var(--color-text-secondary);
  font-size: var(--font-size-lg);
}

.config-panel {
  background-color: var(--color-surface);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  padding: var(--space-24);
  margin-bottom: var(--space-24);
  box-shadow: var(--shadow-sm);
}

.config-row {
  display: flex;
  gap: var(--space-12);
  align-items: flex-end;
  margin-bottom: var(--space-16);
}

.form-group {
  flex: 1;
}

.form-label {
  display: block;
  margin-bottom: var(--space-8);
  font-weight: var(--font-weight-medium);
  font-size: var(--font-size-sm);
  color: var(--color-text);
}

.form-control {
  display: block;
  width: 100%;
  padding: var(--space-10) var(--space-12);
  font-size: var(--font-size-md);
  line-height: 1.5;
  color: var(--color-text);
  background-color: var(--color-background);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  transition: border-color var(--duration-fast) var(--ease-standard),
    box-shadow var(--duration-fast) var(--ease-standard);
}

select.form-control {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  background-image: var(--select-caret-dark);
  background-repeat: no-repeat;
  background-position: right var(--space-12) center;
  background-size: 16px;
  padding-right: var(--space-32);
}

select.form-control option {
  background-color: #2a2a2a;
  color: #e0e0e0;
}



.form-control:focus {
  border-color: var(--color-primary);
  outline: var(--focus-outline);
}

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-10) var(--space-20);
  border-radius: var(--radius-base);
  font-size: var(--font-size-base);
  font-weight: 500;
  line-height: 1.5;
  cursor: pointer;
  transition: all var(--duration-normal) var(--ease-standard);
  border: none;
  text-decoration: none;
  position: relative;
}

.btn:focus-visible {
  outline: none;
  box-shadow: var(--focus-ring);
}

.btn--primary {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
}

.btn--primary:hover {
  background: var(--color-primary-hover);
}

.btn--primary:active {
  background: var(--color-primary-active);
}

.btn--secondary {
  background: var(--color-secondary);
  color: var(--color-text);
}

.btn--secondary:hover {
  background: var(--color-secondary-hover);
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.info-text {
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  margin: 0;
}

.exercise-card {
  background-color: var(--color-surface);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  padding: var(--space-32);
  box-shadow: var(--shadow-sm);
  margin-bottom: var(--space-24);
}

.progress-bar {
  text-align: center;
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  color: var(--color-primary);
  margin-bottom: var(--space-24);
}

.question-box {
  background-color: var(--color-bg-1);
  border-radius: var(--radius-md);
  padding: var(--space-24);
  margin-bottom: var(--space-24);
}

.question-label {
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-12);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.question-content {
  font-size: var(--font-size-2xl);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  margin-bottom: var(--space-16);
}

.answer-group {
  margin-bottom: var(--space-16);
}

.answer-input {
  width: 100%;
  padding: var(--space-12) var(--space-16);
  font-size: var(--font-size-xl);
  border: 2px solid var(--color-border);
  border-radius: var(--radius-base);
  background-color: var(--color-background);
  color: var(--color-text);
}

.answer-input:focus {
  border-color: var(--color-primary);
  outline: var(--focus-outline);
}

/* Correction fields (correction-input) */
.correction-fields {
  display: grid;
  gap: var(--space-12);
  grid-template-columns: 1fr 1fr;
}

@media (max-width: 600px) {
  .correction-fields {
    grid-template-columns: 1fr;
  }
}

.correction-input {
  background: rgba(255, 255, 255, 0.1) !important;
  color: #e0e0e0 !important;
  font-weight: bold !important;
  opacity: 1 !important;
  cursor: not-allowed;
}

.shown-input {
  background: rgba(255, 255, 255, 0.1);
  font-weight: bold;
  color: #e0e0e0;
  cursor: not-allowed;
}

.correct-answer-label {
  margin: var(--space-8) 0 var(--space-12) 0;
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
}
  border-color: var(--color-primary);
  outline: var(--focus-outline);
}

.feedback {
  padding: var(--space-16);
  border-radius: var(--radius-base);
  margin-bottom: var(--space-16);
  font-weight: var(--font-weight-medium);
}

.feedback--success {
  background-color: rgba(var(--color-success-rgb), 0.15);
  color: var(--color-success);
  border: 1px solid rgba(var(--color-success-rgb), 0.25);
}

.feedback--error {
  background-color: rgba(var(--color-error-rgb), 0.15);
  color: var(--color-error);
  border: 1px solid rgba(var(--color-error-rgb), 0.25);
}

.correct-answer {
  margin-top: var(--space-8);
  font-size: var(--font-size-base);
}

.button-group {
  display: flex;
  gap: var(--space-12);
}

.button-group .btn {
  flex: 1;
}

.final-score {
  background-color: var(--color-bg-3);
  border-radius: var(--radius-lg);
  padding: var(--space-32);
  text-align: center;
}

.final-score h2 {
  margin-bottom: var(--space-16);
}

.score-number {
  font-size: var(--font-size-4xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-primary);
  margin-bottom: var(--space-24);
}

.hidden {
  display: none;
}

/* Additional dark theme overrides */
input[type="text"],
input[type="number"],
select,
textarea {
  background-color: #242424 !important;
  color: #e0e0e0 !important;
  border-color: rgba(255, 255, 255, 0.1) !important;
}

input[type="text"]::placeholder,
input[type="number"]::placeholder,
textarea::placeholder {
  color: rgba(224, 224, 224, 0.4);
}

input[type="checkbox"] {
  accent-color: #32B8C6;
}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Révision des Verbes Irréguliers</h1>
            <p>Choisissez une plage de verbes et révisez jusqu'à 10 verbes aléatoires</p>
        </div>

        <div class="config-panel">
            <div class="config-row">
                <div class="form-group">
                    <label for="startVerbSelect" class="form-label">Verbe de départ</label>
                    <select id="startVerbSelect" class="form-control">
                        <option value="">-- Choisir --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="endVerbSelect" class="form-label">Verbe de fin</label>
                    <select id="endVerbSelect" class="form-control">
                        <option value="">-- Choisir --</option>
                    </select>
                </div>
                <button id="loadVerbsBtn" class="btn btn--primary">Charger les verbes</button>
            </div>
            <div style="margin-top: var(--space-12);">
                <button id="manageListBtn" class="btn btn--secondary">Gérer la liste</button>
            </div>
            <div style="margin-top: var(--space-16); display: flex; gap: var(--space-16); flex-wrap: wrap;">
                <p class="info-text">Total de verbes disponibles : <strong>83</strong></p>
                <p id="selectedVerbsInfo" class="info-text">Verbes sélectionnés : <strong id="selectedCount">20</strong></p>
            </div>
            <p id="verbsLoadedInfo" class="info-text hidden"></p>
        </div>

        <div id="exerciseArea" class="hidden">
            <div class="exercise-card">
                <div class="progress-bar" id="progressBar">Question 1/10</div>
                
                <div class="question-box">
                    <div class="question-label" id="questionLabel">Complétez</div>
                    <div class="question-content" id="questionContent"></div>
                </div>



                <div id="feedback" class="feedback hidden"></div>

                <div class="button-group">
                    <button id="validateBtn" class="btn btn--primary">Valider</button>
                    <button id="dontKnowBtn" class="btn btn--secondary">Je ne sais pas</button>
                    <button id="nextBtn" class="btn btn--secondary hidden">Verbe suivant</button>
                </div>
            </div>

            <div class="button-group">
                <button id="restartBtn" class="btn btn--secondary">Recommencer</button>
            </div>
        </div>

        <div id="verbManagementPanel" class="config-panel hidden">
            <h3 style="margin-bottom: var(--space-16);">Sélectionner les verbes</h3>
            <div style="display: flex; gap: var(--space-12); margin-bottom: var(--space-16); flex-wrap: wrap;">
                <button id="selectAllBtn" class="btn btn--secondary">Tout sélectionner</button>
                <button id="deselectAllBtn" class="btn btn--secondary">Tout désélectionner</button>
                <button id="addVerbBtn" class="btn btn--secondary">➕ Ajouter un verbe</button>
            </div>
            
            <div id="addVerbForm" class="hidden" style="background-color: var(--color-bg-2); padding: var(--space-16); border-radius: var(--radius-base); margin-bottom: var(--space-16);">
                <h4 style="margin-bottom: var(--space-16);">Nouveau verbe</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-12); margin-bottom: var(--space-16);">
                    <div class="form-group">
                        <label class="form-label">Base (infinitif)</label>
                        <input type="text" id="newVerbBase" class="form-control" placeholder="ex: speak">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Prétérit</label>
                        <input type="text" id="newVerbPreterit" class="form-control" placeholder="ex: spoke">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Participe passé</label>
                        <input type="text" id="newVerbPastParticiple" class="form-control" placeholder="ex: spoken">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Traduction</label>
                        <input type="text" id="newVerbTranslation" class="form-control" placeholder="ex: parler">
                    </div>
                </div>
                <div style="display: flex; gap: var(--space-12);">
                    <button id="cancelAddVerbBtn" class="btn btn--secondary">Annuler</button>
                    <button id="confirmAddVerbBtn" class="btn btn--primary">Ajouter</button>
                </div>
            </div>
            
            <div id="verbCheckboxContainer" style="max-height: 400px; overflow-y: auto; border: 1px solid var(--color-border); border-radius: var(--radius-base); padding: var(--space-16); background-color: var(--color-background); margin-bottom: var(--space-16);">
                <div id="verbCheckboxList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: var(--space-8);"></div>
            </div>
            
            <div style="display: flex; gap: var(--space-12); justify-content: flex-end;">
                <button id="cancelManageBtn" class="btn btn--secondary">Annuler</button>
                <button id="saveSelectionBtn" class="btn btn--primary">Enregistrer la sélection</button>
            </div>
        </div>

        <div id="finalScoreArea" class="final-score hidden">
            <h2>Exercice terminé !</h2>
            <div class="score-number" id="finalScore">0/10</div>
            <button id="newExerciseBtn" class="btn btn--primary">Nouvel exercice</button>
        </div>
    </div>

    <script>
        // Base de données des verbes irréguliers triés alphabétiquement
        const allVerbs = [
            { base: "arise", preterit: "arose", past_participle: "arisen", translation: "surgir" },
            { base: "awake", preterit: "awoke", past_participle: "awoken", translation: "réveiller" },
            { base: "be", preterit: "was/were", past_participle: "been", translation: "être" },
            { base: "beat", preterit: "beat", past_participle: "beaten", translation: "battre" },
            { base: "begin", preterit: "began", past_participle: "begun", translation: "commencer" },
            { base: "bite", preterit: "bit", past_participle: "bitten", translation: "mordre" },
            { base: "blow", preterit: "blew", past_participle: "blown", translation: "souffler" },
            { base: "break", preterit: "broke", past_participle: "broken", translation: "casser" },
            { base: "bring", preterit: "brought", past_participle: "brought", translation: "apporter" },
            { base: "build", preterit: "built", past_participle: "built", translation: "construire" },
            { base: "buy", preterit: "bought", past_participle: "bought", translation: "acheter" },
            { base: "catch", preterit: "caught", past_participle: "caught", translation: "attraper" },
            { base: "choose", preterit: "chose", past_participle: "chosen", translation: "choisir" },
            { base: "come", preterit: "came", past_participle: "come", translation: "venir" },
            { base: "cost", preterit: "cost", past_participle: "cost", translation: "coûter" },
            { base: "cut", preterit: "cut", past_participle: "cut", translation: "couper" },
            { base: "do", preterit: "did", past_participle: "done", translation: "faire" },
            { base: "draw", preterit: "drew", past_participle: "drawn", translation: "dessiner/tirer" },
            { base: "drink", preterit: "drank", past_participle: "drunk", translation: "boire" },
            { base: "drive", preterit: "drove", past_participle: "driven", translation: "conduire" },
            { base: "eat", preterit: "ate", past_participle: "eaten", translation: "manger" },
            { base: "fall", preterit: "fell", past_participle: "fallen", translation: "tomber" },
            { base: "feel", preterit: "felt", past_participle: "felt", translation: "sentir/ressentir" },
            { base: "find", preterit: "found", past_participle: "found", translation: "trouver" },
            { base: "fly", preterit: "flew", past_participle: "flown", translation: "voler" },
            { base: "forget", preterit: "forgot", past_participle: "forgotten", translation: "oublier" },
            { base: "forgive", preterit: "forgave", past_participle: "forgiven", translation: "pardonner" },
            { base: "get", preterit: "got", past_participle: "gotten", translation: "obtenir" },
            { base: "give", preterit: "gave", past_participle: "given", translation: "donner" },
            { base: "go", preterit: "went", past_participle: "gone", translation: "aller" },
            { base: "grow", preterit: "grew", past_participle: "grown", translation: "grandir/cultiver" },
            { base: "have", preterit: "had", past_participle: "had", translation: "avoir" },
            { base: "hear", preterit: "heard", past_participle: "heard", translation: "entendre" },
            { base: "hide", preterit: "hid", past_participle: "hidden", translation: "cacher" },
            { base: "hit", preterit: "hit", past_participle: "hit", translation: "frapper" },
            { base: "hold", preterit: "held", past_participle: "held", translation: "tenir" },
            { base: "hurt", preterit: "hurt", past_participle: "hurt", translation: "blesser" },
            { base: "keep", preterit: "kept", past_participle: "kept", translation: "garder" },
            { base: "know", preterit: "knew", past_participle: "known", translation: "connaître/savoir" },
            { base: "lay", preterit: "laid", past_participle: "laid", translation: "poser/mettre" },
            { base: "learn", preterit: "learnt", past_participle: "learnt", translation: "apprendre" },
            { base: "leave", preterit: "left", past_participle: "left", translation: "partir/laisser" },
            { base: "lend", preterit: "lent", past_participle: "lent", translation: "prêter" },
            { base: "let", preterit: "let", past_participle: "let", translation: "laisser/permettre" },
            { base: "lie", preterit: "lay", past_participle: "lain", translation: "s'allonger" },
            { base: "lose", preterit: "lost", past_participle: "lost", translation: "perdre" },
            { base: "make", preterit: "made", past_participle: "made", translation: "faire/fabriquer" },
            { base: "mean", preterit: "meant", past_participle: "meant", translation: "signifier" },
            { base: "meet", preterit: "met", past_participle: "met", translation: "rencontrer" },
            { base: "pay", preterit: "paid", past_participle: "paid", translation: "payer" },
            { base: "put", preterit: "put", past_participle: "put", translation: "mettre" },
            { base: "read", preterit: "read", past_participle: "read", translation: "lire" },
            { base: "rent", preterit: "rent", past_participle: "rent", translation: "louer" },
            { base: "ride", preterit: "rode", past_participle: "ridden", translation: "chevaucher" },
            { base: "ring", preterit: "rang", past_participle: "rung", translation: "sonner" },
            { base: "rise", preterit: "rose", past_participle: "risen", translation: "se lever" },
            { base: "run", preterit: "ran", past_participle: "run", translation: "courir" },
            { base: "say", preterit: "said", past_participle: "said", translation: "dire" },
            { base: "see", preterit: "saw", past_participle: "seen", translation: "voir" },
            { base: "sell", preterit: "sold", past_participle: "sold", translation: "vendre" },
            { base: "send", preterit: "sent", past_participle: "sent", translation: "envoyer" },
            { base: "set", preterit: "set", past_participle: "set", translation: "mettre/positionner" },
            { base: "shine", preterit: "shone", past_participle: "shone", translation: "briller" },
            { base: "shake", preterit: "shook", past_participle: "shaken", translation: "secouer" },
            { base: "shoot", preterit: "shot", past_participle: "shot", translation: "tirer" },
            { base: "show", preterit: "showed", past_participle: "shown", translation: "montrer" },
            { base: "shut", preterit: "shut", past_participle: "shut", translation: "fermer" },
            { base: "sing", preterit: "sang", past_participle: "sung", translation: "chanter" },
             { base: "sit", preterit: "sat", past_participle: "sat", translation: "s'asseoir" },
            { base: "sleep", preterit: "slept", past_participle: "slept", translation: "dormir" },
            { base: "smell", preterit: "smelt", past_participle: "smelt", translation: "sentir" },
            { base: "speak", preterit: "spoke", past_participle: "spoken", translation: "parler" },
            { base: "spend", preterit: "spent", past_participle: "spent", translation: "dépenser" },
            { base: "stand", preterit: "stood", past_participle: "stood", translation: "se tenir debout" },
            { base: "steal", preterit: "stole", past_participle: "stolen", translation: "voler" },
            { base: "swim", preterit: "swam", past_participle: "swum", translation: "nager" },
            { base: "take", preterit: "took", past_participle: "taken", translation: "prendre" },
            { base: "teach", preterit: "taught", past_participle: "taught", translation: "enseigner" },
            { base: "tell", preterit: "told", past_participle: "told", translation: "raconter" },
            { base: "think", preterit: "thought", past_participle: "thought", translation: "penser" },
            { base: "throw", preterit: "threw", past_participle: "thrown", translation: "lancer" },
            { base: "understand", preterit: "understood", past_participle: "understood", translation: "comprendre" },
            { base: "wake", preterit: "woke", past_participle: "woken", translation: "se réveiller" },
            { base: "wear", preterit: "wore", past_participle: "worn", translation: "porter" },
            { base: "win", preterit: "won", past_participle: "won", translation: "gagner" },
            { base: "write", preterit: "wrote", past_participle: "written", translation: "écrire" }
        ];

        const verbsByLetter = {
            A: [
                { base: "arise", preterit: "arose", past_participle: "arisen", translation: "surgir" },
                { base: "awake", preterit: "awoke", past_participle: "awoken", translation: "réveiller" },
                { base: "be", preterit: "was/were", past_participle: "been", translation: "être" }
            ],
            B: [
                { base: "beat", preterit: "beat", past_participle: "beaten", translation: "battre" },
                { base: "begin", preterit: "began", past_participle: "begun", translation: "commencer" },
                { base: "break", preterit: "broke", past_participle: "broken", translation: "casser" },
                { base: "bring", preterit: "brought", past_participle: "brought", translation: "apporter" },
                { base: "build", preterit: "built", past_participle: "built", translation: "construire" },
                { base: "bite", preterit: "bit", past_participle: "bitten", translation: "mordre" },
                { base: "blow", preterit: "blew", past_participle: "blown", translation: "souffler" },
                { base: "buy", preterit: "bought", past_participle: "bought", translation: "acheter" }
            ],
            C: [
                { base: "catch", preterit: "caught", past_participle: "caught", translation: "attraper" },
                { base: "choose", preterit: "chose", past_participle: "chosen", translation: "choisir" },
                { base: "come", preterit: "came", past_participle: "come", translation: "venir" },
                { base: "cut", preterit: "cut", past_participle: "cut", translation: "couper" },
                { base: "cost", preterit: "cost", past_participle: "cost", translation: "coûter" }
            ],
            D: [
                { base: "do", preterit: "did", past_participle: "done", translation: "faire" },
                { base: "draw", preterit: "drew", past_participle: "drawn", translation: "dessiner/tirer" },
                { base: "drink", preterit: "drank", past_participle: "drunk", translation: "boire" },
                { base: "drive", preterit: "drove", past_participle: "driven", translation: "conduire" }
            ],
            E: [
                { base: "eat", preterit: "ate", past_participle: "eaten", translation: "manger" }
            ],
            F: [
                { base: "fall", preterit: "fell", past_participle: "fallen", translation: "tomber" },
                { base: "feel", preterit: "felt", past_participle: "felt", translation: "sentir/ressentir" },
                { base: "find", preterit: "found", past_participle: "found", translation: "trouver" },
                { base: "fly", preterit: "flew", past_participle: "flown", translation: "voler" },
                { base: "forget", preterit: "forgot", past_participle: "forgotten", translation: "oublier" },
                { base: "forgive", preterit: "forgave", past_participle: "forgiven", translation: "pardonner" }
            ],
            G: [
                { base: "give", preterit: "gave", past_participle: "given", translation: "donner" },
                { base: "go", preterit: "went", past_participle: "gone", translation: "aller" },
                { base: "grow", preterit: "grew", past_participle: "grown", translation: "grandir/cultiver" },
                { base: "get", preterit: "got", past_participle: "gotten", translation: "obtenir" }
            ],
            H: [
                { base: "have", preterit: "had", past_participle: "had", translation: "avoir" },
                { base: "hear", preterit: "heard", past_participle: "heard", translation: "entendre" },
                { base: "hide", preterit: "hid", past_participle: "hidden", translation: "cacher" },
                { base: "hit", preterit: "hit", past_participle: "hit", translation: "frapper" },
                { base: "hold", preterit: "held", past_participle: "held", translation: "tenir" },
                { base: "hurt", preterit: "hurt", past_participle: "hurt", translation: "blesser" }
            ],
            K: [
                { base: "keep", preterit: "kept", past_participle: "kept", translation: "garder" },
                { base: "know", preterit: "knew", past_participle: "known", translation: "connaître/savoir" },
                { base: "lay", preterit: "laid", past_participle: "laid", translation: "poser/mettre" },
                { base: "learn", preterit: "learnt", past_participle: "learnt", translation: "apprendre" }
            ],
            L: [
                { base: "leave", preterit: "left", past_participle: "left", translation: "partir/laisser" },
                { base: "lend", preterit: "lent", past_participle: "lent", translation: "prêter" },
                { base: "let", preterit: "let", past_participle: "let", translation: "laisser/permettre" },
                { base: "lie", preterit: "lay", past_participle: "lain", translation: "s'allonger" },
                { base: "lose", preterit: "lost", past_participle: "lost", translation: "perdre" }
            ],
            M: [
                { base: "make", preterit: "made", past_participle: "made", translation: "faire/fabriquer" },
                { base: "mean", preterit: "meant", past_participle: "meant", translation: "signifier" },
                { base: "meet", preterit: "met", past_participle: "met", translation: "rencontrer" }
            ],
            P: [
                { base: "pay", preterit: "paid", past_participle: "paid", translation: "payer" },
                { base: "put", preterit: "put", past_participle: "put", translation: "mettre" }
            ],
            R: [
                { base: "read", preterit: "read", past_participle: "read", translation: "lire" },
                { base: "rent", preterit: "rent", past_participle: "rent", translation: "louer" },
                { base: "ride", preterit: "rode", past_participle: "ridden", translation: "chevaucher" },
                { base: "ring", preterit: "rang", past_participle: "rung", translation: "sonner" },
                { base: "rise", preterit: "rose", past_participle: "risen", translation: "se lever" },
                { base: "run", preterit: "ran", past_participle: "run", translation: "courir" }
            ],
            S: [
                { base: "say", preterit: "said", past_participle: "said", translation: "dire" },
                { base: "see", preterit: "saw", past_participle: "seen", translation: "voir" },
                { base: "sell", preterit: "sold", past_participle: "sold", translation: "vendre" },
                { base: "send", preterit: "sent", past_participle: "sent", translation: "envoyer" },
                { base: "set", preterit: "set", past_participle: "set", translation: "mettre/positionner" },
                { base: "shake", preterit: "shook", past_participle: "shaken", translation: "secouer" },
                { base: "shine", preterit: "shone", past_participle: "shone", translation: "briller" },
                { base: "shoot", preterit: "shot", past_participle: "shot", translation: "tirer" },
                { base: "show", preterit: "showed", past_participle: "shown", translation: "montrer" },
                { base: "shut", preterit: "shut", past_participle: "shut", translation: "fermer" },
                { base: "sing", preterit: "sang", past_participle: "sung", translation: "chanter" },
                { base: "sit", preterit: "sat", past_participle: "sat", translation: "s'asseoir" },
                { base: "sleep", preterit: "slept", past_participle: "slept", translation: "dormir" },
                { base: "smell", preterit: "smelt", past_participle: "smelt", translation: "sentir" },
                { base: "speak", preterit: "spoke", past_participle: "spoken", translation: "parler" },
                { base: "spend", preterit: "spent", past_participle: "spent", translation: "dépenser" },
                { base: "stand", preterit: "stood", past_participle: "stood", translation: "se tenir debout" },
                { base: "steal", preterit: "stole", past_participle: "stolen", translation: "voler" },
                { base: "swim", preterit: "swam", past_participle: "swum", translation: "nager" }
            ],
            T: [
                { base: "take", preterit: "took", past_participle: "taken", translation: "prendre" },
                { base: "teach", preterit: "taught", past_participle: "taught", translation: "enseigner" },
                { base: "tell", preterit: "told", past_participle: "told", translation: "raconter" },
                { base: "think", preterit: "thought", past_participle: "thought", translation: "penser" },
                { base: "throw", preterit: "threw", past_participle: "thrown", translation: "lancer" }
            ],
            U: [
                { base: "understand", preterit: "understood", past_participle: "understood", translation: "comprendre" }
            ],
            W: [
                { base: "wake", preterit: "woke", past_participle: "woken", translation: "se réveiller" },
                { base: "wear", preterit: "wore", past_participle: "worn", translation: "porter" },
                { base: "win", preterit: "won", past_participle: "won", translation: "gagner" },
                { base: "write", preterit: "wrote", past_participle: "written", translation: "écrire" }
            ]
        };

        // Variables d'état
        let selectedVerbsSet = new Set();
        let selectedVerbs = [];
        let currentIndex = 0;
        let score = 0;
        let currentQuestion = null;
        let hasValidated = false;
        let currentVerb = null;

        // Éléments du DOM
        const startVerbSelect = document.getElementById('startVerbSelect');
        const endVerbSelect = document.getElementById('endVerbSelect');
        const loadVerbsBtn = document.getElementById('loadVerbsBtn');
        const verbsLoadedInfo = document.getElementById('verbsLoadedInfo');
        const exerciseArea = document.getElementById('exerciseArea');
        const progressBar = document.getElementById('progressBar');
        const questionLabel = document.getElementById('questionLabel');
        const questionContent = document.getElementById('questionContent');
        const answerInput = document.getElementById('answerInput');
        const validateBtn = document.getElementById('validateBtn');
        const nextBtn = document.getElementById('nextBtn');
        const feedback = document.getElementById('feedback');
        const restartBtn = document.getElementById('restartBtn');
        const finalScoreArea = document.getElementById('finalScoreArea');
        const finalScore = document.getElementById('finalScore');
        const newExerciseBtn = document.getElementById('newExerciseBtn');
        const dontKnowBtn = document.getElementById('dontKnowBtn');
        const manageListBtn = document.getElementById('manageListBtn');
        const verbManagementPanel = document.getElementById('verbManagementPanel');
        const selectAllBtn = document.getElementById('selectAllBtn');
        const deselectAllBtn = document.getElementById('deselectAllBtn');
        const addVerbBtn = document.getElementById('addVerbBtn');
        const addVerbForm = document.getElementById('addVerbForm');
        const cancelAddVerbBtn = document.getElementById('cancelAddVerbBtn');
        const confirmAddVerbBtn = document.getElementById('confirmAddVerbBtn');
        const cancelManageBtn = document.getElementById('cancelManageBtn');
        const saveSelectionBtn = document.getElementById('saveSelectionBtn');
        const verbCheckboxList = document.getElementById('verbCheckboxList');

        // Fonction pour mélanger un tableau (Fisher-Yates shuffle)
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Fonction pour initialiser la sélection par défaut (have to put)
        function initializeDefaultSelection() {
            selectedVerbsSet.clear();
            const startIdx = allVerbs.findIndex(v => v.base === 'read');
            const endIdx = allVerbs.findIndex(v => v.base === 'smell');
            if (startIdx !== -1 && endIdx !== -1) {
                for (let i = startIdx; i <= endIdx; i++) {
                    selectedVerbsSet.add(allVerbs[i].base);
                }
            }
            updateSelectedCount();
        }

        // Fonction pour mettre à jour le compteur
        function updateSelectedCount() {
            const selectedCountElem = document.getElementById('selectedCount');
            if (selectedCountElem) {
                selectedCountElem.textContent = selectedVerbsSet.size;
            }
        }

        // Fonction pour initialiser les dropdowns
        function initializeDropdowns() {
            allVerbs.forEach(verb => {
                const optionStart = document.createElement('option');
                optionStart.value = verb.base;
                optionStart.textContent = `${verb.base} (${verb.translation})`;
                startVerbSelect.appendChild(optionStart);

                const optionEnd = document.createElement('option');
                optionEnd.value = verb.base;
                optionEnd.textContent = `${verb.base} (${verb.translation})`;
                endVerbSelect.appendChild(optionEnd);
            });
        }

        // Fonction pour rendre les checkboxes
        function renderVerbCheckboxes() {
            verbCheckboxList.innerHTML = '';
            allVerbs.forEach(verb => {
                const label = document.createElement('label');
                label.style.display = 'flex';
                label.style.alignItems = 'center';
                label.style.gap = 'var(--space-8)';
                label.style.cursor = 'pointer';
                label.style.padding = 'var(--space-4)';
                label.style.borderRadius = 'var(--radius-sm)';
                label.style.transition = 'background-color var(--duration-fast)';
                label.addEventListener('mouseenter', () => {
                    label.style.backgroundColor = 'rgba(255, 255, 255, 0.08)';
                });
                label.addEventListener('mouseleave', () => {
                    label.style.backgroundColor = 'transparent';
                });
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = verb.base;
                checkbox.checked = selectedVerbsSet.has(verb.base);
                checkbox.style.cursor = 'pointer';
                checkbox.addEventListener('change', (e) => {
                    if (e.target.checked) {
                        selectedVerbsSet.add(verb.base);
                    } else {
                        selectedVerbsSet.delete(verb.base);
                    }
                    updateSelectedCount();
                });
                
                const text = document.createElement('span');
                text.textContent = `${verb.base} (${verb.translation})`;
                text.style.fontSize = 'var(--font-size-sm)';
                
                label.appendChild(checkbox);
                label.appendChild(text);
                verbCheckboxList.appendChild(label);
            });
        }

        // Fonction pour ouvrir le panneau de gestion
        function openManagePanel() {
            renderVerbCheckboxes();
            verbManagementPanel.classList.remove('hidden');
        }

        // Fonction pour fermer le panneau de gestion
        function closeManagePanel() {
            verbManagementPanel.classList.add('hidden');
            addVerbForm.classList.add('hidden');
        }

        // Fonction pour tout sélectionner
        function selectAll() {
            selectedVerbsSet.clear();
            allVerbs.forEach(v => selectedVerbsSet.add(v.base));
            renderVerbCheckboxes();
            updateSelectedCount();
        }

        // Fonction pour tout désélectionner
        function deselectAll() {
            selectedVerbsSet.clear();
            renderVerbCheckboxes();
            updateSelectedCount();
        }

        // Fonction pour afficher le formulaire d'ajout
        function showAddVerbForm() {
            addVerbForm.classList.remove('hidden');
        }

        // Fonction pour cacher le formulaire d'ajout
        function hideAddVerbForm() {
            addVerbForm.classList.add('hidden');
            document.getElementById('newVerbBase').value = '';
            document.getElementById('newVerbPreterit').value = '';
            document.getElementById('newVerbPastParticiple').value = '';
            document.getElementById('newVerbTranslation').value = '';
        }

        // Fonction pour ajouter un nouveau verbe
        function addNewVerb() {
            const base = document.getElementById('newVerbBase').value.trim().toLowerCase();
            const preterit = document.getElementById('newVerbPreterit').value.trim().toLowerCase();
            const pastParticiple = document.getElementById('newVerbPastParticiple').value.trim().toLowerCase();
            const translation = document.getElementById('newVerbTranslation').value.trim().toLowerCase();

            if (!base || !preterit || !pastParticiple || !translation) {
                alert('Veuillez remplir tous les champs');
                return;
            }

            // Vérifier si le verbe existe déjà
            if (allVerbs.find(v => v.base === base)) {
                alert('Ce verbe existe déjà dans la liste');
                return;
            }

            // Créer le nouveau verbe
            const newVerb = {
                base,
                preterit,
                past_participle: pastParticiple,
                translation
            };

            // Ajouter et trier alphabétiquement
            allVerbs.push(newVerb);
            allVerbs.sort((a, b) => a.base.localeCompare(b.base));

            // Auto-sélectionner le nouveau verbe
            selectedVerbsSet.add(base);

            // Mettre à jour les dropdowns
            updateDropdowns();

            // Rerender les checkboxes
            renderVerbCheckboxes();
            updateSelectedCount();

            // Cacher le formulaire
            hideAddVerbForm();

            alert(`Verbe "${base}" ajouté avec succès !`);
        }

        // Fonction pour mettre à jour les dropdowns après ajout
        function updateDropdowns() {
            const startValue = startVerbSelect.value;
            const endValue = endVerbSelect.value;

            startVerbSelect.innerHTML = '<option value="">-- Choisir --</option>';
            endVerbSelect.innerHTML = '<option value="">-- Choisir --</option>';

            allVerbs.forEach(verb => {
                const optionStart = document.createElement('option');
                optionStart.value = verb.base;
                optionStart.textContent = `${verb.base} (${verb.translation})`;
                startVerbSelect.appendChild(optionStart);

                const optionEnd = document.createElement('option');
                optionEnd.value = verb.base;
                optionEnd.textContent = `${verb.base} (${verb.translation})`;
                endVerbSelect.appendChild(optionEnd);
            });

            startVerbSelect.value = startValue;
            endVerbSelect.value = endValue;
        }

        // Fonction pour sauvegarder la sélection
        function saveSelection() {
            updateSelectedCount();
            closeManagePanel();
        }

        // Fonction pour charger les verbes
        function loadVerbs() {
            const startVerb = startVerbSelect.value;
            const endVerb = endVerbSelect.value;

            if (!startVerb || !endVerb) {
                alert('Veuillez sélectionner un verbe de départ et un verbe de fin');
                return;
            }

            // Trouver les indices des verbes
            const startIndex = allVerbs.findIndex(v => v.base === startVerb);
            const endIndex = allVerbs.findIndex(v => v.base === endVerb);

            if (startIndex === -1 || endIndex === -1) {
                alert('Erreur lors de la sélection des verbes');
                return;
            }

            if (startIndex > endIndex) {
                alert('Le verbe de départ doit être avant le verbe de fin alphabétiquement');
                return;
            }

            // Si aucun verbe n'est sélectionné via les checkboxes, utiliser la plage
            let verbsToUse;
            if (selectedVerbsSet.size === 0) {
                // Extraire la plage de verbes
                verbsToUse = allVerbs.slice(startIndex, endIndex + 1);
            } else {
                // Utiliser les verbes sélectionnés qui sont dans la plage
                const verbsRange = allVerbs.slice(startIndex, endIndex + 1);
                verbsToUse = verbsRange.filter(v => selectedVerbsSet.has(v.base));
                
                if (verbsToUse.length === 0) {
                    alert('Aucun verbe sélectionné dans cette plage. Veuillez ajuster votre sélection.');
                    return;
                }
            }
            
            const verbsRange = verbsToUse;
            const availableCount = verbsRange.length;

            // Mélanger et prendre jusqu'à 10 verbes
            const shuffled = shuffleArray(verbsRange);
            selectedVerbs = shuffled.slice(0, Math.min(10, shuffled.length));

            // Réinitialiser l'état
            currentIndex = 0;
            score = 0;
            hasValidated = false;

            // Afficher les informations
            verbsLoadedInfo.textContent = `${selectedVerbs.length} verbe(s) sélectionné(s) parmi ${availableCount} disponible(s) (de "${startVerb}" à "${endVerb}")`;
            verbsLoadedInfo.classList.remove('hidden');
            
            // Mettre à jour le compteur de verbes sélectionnés
            const selectedCountElem = document.getElementById('selectedCount');
            if (selectedCountElem) {
                selectedCountElem.textContent = selectedVerbs.length;
            }

            // Afficher la zone d'exercice
            exerciseArea.classList.remove('hidden');
            finalScoreArea.classList.add('hidden');

            // Afficher la première question
            showQuestion();
        }

        // Génère la structure pour question : un champ pré-rempli, 3 champs à remplir séparés
        function generateQuestion(verb) {
            const fields = ['base', 'preterit', 'past_participle', 'translation'];
            const labels = {
                base: 'Base (infinitive)',
                preterit: 'Prétérit',
                past_participle: 'Participe passé',
                translation: 'Traduction'
            };
            // On choisit au hasard le champ à PRÉ-REMPLIR
            const shownIndex = Math.floor(Math.random() * 4);
            const shownForm = fields[shownIndex];
            let missing = fields.filter(f => f !== shownForm);
            // Structure de la "question" : quelle clé est affichée, quelles sont les valeurs à remplir
            return {
                fields,
                labels,
                shownForm,
                verb,
                missing // Champs à compléter
            };
        }

        // Fonction pour construire le formulaire (4 champs)
        function showQuestion() {
            if (currentIndex >= selectedVerbs.length) {
                showFinalScore();
                return;
            }

            currentVerb = selectedVerbs[currentIndex];
            currentQuestion = generateQuestion(currentVerb);
            hasValidated = false;

            // Affichage compteur
            progressBar.textContent = `Question ${currentIndex + 1}/${selectedVerbs.length}`;
            questionLabel.textContent = `Complétez les formes manquantes :`;

            // Clear area
            questionContent.innerHTML = '';
            // On va générer les 4 champs
            currentQuestion.fields.forEach(formKey => {
                // Wrapper pour chaque input
                const group = document.createElement('div');
                group.className = 'form-group';
                // Label
                const label = document.createElement('label');
                label.textContent = currentQuestion.labels[formKey];
                label.className = 'form-label';
                group.appendChild(label);
                // Field
                if (formKey === currentQuestion.shownForm) {
                    // Affiché, non éditable
                    const staticInput = document.createElement('input');
                    staticInput.type = 'text';
                    staticInput.value = currentVerb[formKey];
                    staticInput.readOnly = true;
                    staticInput.className = 'answer-input shown-input';
                    staticInput.style.background = 'rgba(255, 255, 255, 0.1)';
                    staticInput.style.fontWeight = 'bold';
                    staticInput.style.color = '#e0e0e0';
                    group.appendChild(staticInput);
                } else {
                    const editInput = document.createElement('input');
                    editInput.type = 'text';
                    editInput.className = 'answer-input answer-edit answer-edit-' + formKey;
                    editInput.autocomplete = 'off';
                    editInput.setAttribute('data-field', formKey);
                    editInput.placeholder = ``;
                    group.appendChild(editInput);
                }
                questionContent.appendChild(group);
            });

            // Focus sur le premier champ éditable
            setTimeout(() => {
                const edit = questionContent.querySelector('.answer-edit');
                if (edit) edit.focus();
            }, 50);

            // Réinitialiser les boutons/états
            validateBtn.classList.remove('hidden');
            validateBtn.disabled = false;
            nextBtn.classList.add('hidden');
            feedback.classList.add('hidden');
            dontKnowBtn.classList.remove('hidden');
        }

        // Fonction pour normaliser une réponse pour comparaison (accents/majuscules/espaces)
        function normalizeAnswer(answer) {
            return (answer ?? '')
                .toLowerCase()
                .trim()
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .replace(/\s+/g, ' ');
        }

        // Fonction pour valider la réponse (les 3 champs à remplir)
        function validateAnswer() {
            if (hasValidated) return;

            const edits = questionContent.querySelectorAll('.answer-edit');
            let answersOk = true;
            let userAnswers = {};
            let correctAnswers = {};
            let wrongFields = [];
            let userInputsByField = {};
            
            currentQuestion.missing.forEach(field => {
                const input = questionContent.querySelector('.answer-edit-' + field);
                const val = input.value;
                const normalizedUser = normalizeAnswer(val);
                const normalizedCorrect = normalizeAnswer(currentVerb[field]);
                
                userAnswers[field] = normalizedUser;
                correctAnswers[field] = normalizedCorrect;
                userInputsByField[field] = val; // Keep original input for display
                
                // Check if answer is correct
                let isCorrect = false;
                if(field === "translation") {
                  isCorrect = (normalizedUser === normalizedCorrect || normalizedCorrect.split('/').map(s=>s.trim()).some(x => normalizedUser === normalizeAnswer(x)));
                } else {
                  isCorrect = (normalizedUser === normalizedCorrect);
                }
                
                if (!isCorrect) {
                    wrongFields.push(field);
                }
                answersOk = answersOk && isCorrect;
            });

            hasValidated = true;
            if (answersOk) {
                score++;
                feedback.textContent = '✓ Correct';
                feedback.className = 'feedback feedback--success';
                feedback.classList.remove('hidden');
                // Lock/disable all inputs
                questionContent.querySelectorAll('input').forEach(input => input.disabled = true);
                // Afficher uniquement "Verbe suivant"
                validateBtn.classList.add('hidden');
                nextBtn.classList.remove('hidden');
                dontKnowBtn.classList.add('hidden');
                nextBtn.focus();
            } else {
                // AFFICHAGE correction avec détails des erreurs
                showCorrectionFieldsSection('incorrect', wrongFields, userInputsByField);
            }
        }

        // Affichage de la correction tous champs (appelée dans validateAnswer si erreur ou si Je ne sais pas)
        function showCorrectionFieldsSection(type, wrongFields = [], userInputsByField = {}) {
            // type: 'incorrect' ou 'dontknow'
            // On efface la question
            questionContent.innerHTML = '';
            const fields = ['base', 'preterit', 'past_participle', 'translation'];
            const labels = {
                base: 'Base (infinitive)',
                preterit: 'Prétérit',
                past_participle: 'Participe passé',
                translation: 'Traduction'
            };
            
            // Feedback message
            if (type === 'incorrect') {
                feedback.innerHTML = '✗ Incorrect';
                feedback.className = 'feedback feedback--error';
            } else {
                feedback.innerHTML = 'Réponse proposée:';
                feedback.className = 'feedback';
                feedback.style.backgroundColor = 'var(--color-secondary)';
                feedback.style.border = '1px solid var(--color-border)';
            }
            feedback.classList.remove('hidden');
            
            // Show detailed error breakdown for incorrect answers
            if (type === 'incorrect' && wrongFields.length > 0) {
                let errorDetailsHtml = '<div style="margin-top: var(--space-16); padding: var(--space-16); background-color: rgba(255, 84, 89, 0.1); border: 1px solid rgba(255, 84, 89, 0.3); border-radius: var(--radius-base);">';
                errorDetailsHtml += '<div style="font-weight: var(--font-weight-semibold); margin-bottom: var(--space-12); color: var(--color-error);">Détails des erreurs :</div>';
                
                wrongFields.forEach(field => {
                    const userInput = userInputsByField[field] || '';
                    const correctAnswer = currentVerb[field];
                    errorDetailsHtml += `
                        <div style="margin-bottom: var(--space-12); font-size: var(--font-size-sm);">
                            <strong>${labels[field]} :</strong><br>
                            Vous avez écrit : <span style="background-color: rgba(255, 84, 89, 0.25); padding: var(--space-4) var(--space-8); border-radius: var(--radius-sm); color: var(--color-error); font-weight: var(--font-weight-semibold);">${userInput || '(vide)'}</span><br>
                            La bonne réponse est : <span style="background-color: rgba(50, 184, 198, 0.25); padding: var(--space-4) var(--space-8); border-radius: var(--radius-sm); color: var(--color-success); font-weight: var(--font-weight-semibold);">${correctAnswer}</span>
                        </div>
                    `;
                });
                
                errorDetailsHtml += '</div>';
                feedback.innerHTML += errorDetailsHtml;
            }
            
            // Bloc contenant les 4 champs corrigés
            let fieldsHtml = '<div class="correction-fields" style="margin-top: var(--space-16);">';
            fields.forEach(key => {
                fieldsHtml += `
                  <div class="form-group">
                    <label class="form-label">${labels[key]}</label>
                    <input type="text" value="${currentVerb[key]}" readonly disabled class="answer-input correction-input">
                  </div>`;
            });
            fieldsHtml += '</div>';
            
            // Affichage
            questionContent.innerHTML = fieldsHtml;
            
            // Styliser les champs corrigés
            const correctionInputs = questionContent.querySelectorAll('.correction-input');
            correctionInputs.forEach(inp => {
                inp.style.background = 'rgba(50, 184, 198, 0.15)';
                inp.style.color = 'var(--color-text)';
                inp.style.fontWeight = 'bold';
                inp.style.opacity = 1;
                inp.style.borderColor = 'rgba(50, 184, 198, 0.3)';
            });

            // Disable all input in the correction
            questionContent.querySelectorAll('input').forEach(input => input.disabled = true);
            
            // Boutons
            validateBtn.classList.add('hidden');
            dontKnowBtn.classList.add('hidden');
            nextBtn.classList.remove('hidden');
            nextBtn.focus();
        }

        // Fonction pour "Je ne sais pas" (affiche la correction)
        function handleDontKnow() {
            if (hasValidated) return;
            hasValidated = true;
            showCorrectionFieldsSection('dontknow');
        }

        // Fonction pour passer à la question suivante
        function nextQuestion() {
            currentIndex++;
            showQuestion();
        }

        // Fonction pour afficher le score final
        function showFinalScore() {
            exerciseArea.classList.add('hidden');
            finalScoreArea.classList.remove('hidden');
            finalScore.textContent = `${score}/${selectedVerbs.length}`;
        }

        // Fonction pour recommencer
        function restart() {
            currentIndex = 0;
            score = 0;
            hasValidated = false;
            exerciseArea.classList.remove('hidden');
            finalScoreArea.classList.add('hidden');
            showQuestion();
        }

        // Fonction pour nouveau exercice
        function newExercise() {
            startVerbSelect.value = '';
            endVerbSelect.value = '';
            selectedVerbs = [];
            currentIndex = 0;
            score = 0;
            hasValidated = false;
            verbsLoadedInfo.classList.add('hidden');
            exerciseArea.classList.add('hidden');
            finalScoreArea.classList.add('hidden');
        }

        // Initialiser au chargement
        initializeDropdowns();
        initializeDefaultSelection();
        
        // Pré-remplir avec "have" à "put" et charger automatiquement
        function autoLoadVerbs() {
            startVerbSelect.value = 'read';
            endVerbSelect.value = 'smell';
            // Charger automatiquement les verbes
            loadVerbs();
        }
        
        // Exécuter le chargement automatique immédiatement après l'initialisation
        autoLoadVerbs();
        
        // Mettre à jour l'affichage initial du nombre de verbes sélectionnés
        const selectedCountElem = document.getElementById('selectedCount');
        if (selectedCountElem && selectedVerbs.length > 0) {
            selectedCountElem.textContent = selectedVerbs.length;
        }


        
        // Event listeners
        manageListBtn.addEventListener('click', openManagePanel);
        selectAllBtn.addEventListener('click', selectAll);
        deselectAllBtn.addEventListener('click', deselectAll);
        addVerbBtn.addEventListener('click', showAddVerbForm);
        cancelAddVerbBtn.addEventListener('click', hideAddVerbForm);
        confirmAddVerbBtn.addEventListener('click', addNewVerb);
        cancelManageBtn.addEventListener('click', closeManagePanel);
        saveSelectionBtn.addEventListener('click', saveSelection);
        loadVerbsBtn.addEventListener('click', loadVerbs);
        validateBtn.addEventListener('click', validateAnswer);
        dontKnowBtn.addEventListener('click', handleDontKnow);
        nextBtn.addEventListener('click', nextQuestion);
        restartBtn.addEventListener('click', function() {
            currentIndex = 0;
            score = 0;
            hasValidated = false;
            exerciseArea.classList.remove('hidden');
            finalScoreArea.classList.add('hidden');
            showQuestion();
        });
        newExerciseBtn.addEventListener('click', newExercise);

        // Permettre la validation avec la touche Entrée sur tous les inputs éditables
        document.addEventListener('keypress', (e) => {
            if (e.key !== 'Enter') return;
            const focusElem = document.activeElement;
            if (focusElem && focusElem.classList.contains('answer-edit')) {
                if (!hasValidated) {
                    validateAnswer();
                } else {
                    nextQuestion();
                }
            }
        });
    </script>
</body>
</html>
